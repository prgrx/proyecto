<ion-header translucent>
  <ion-toolbar>
    <div class="toolbar-top mt-2 d-flex flex-row justify-content-around">
      <ion-title>Productos</ion-title>
      <ion-button (click)="openMenuSort()" slot="end" fill="outline" color="dark" class="me-4">
        <ion-icon name="funnel"></ion-icon>
      </ion-button>
    </div>
    <ion-segment value="options" [(ngModel)]="segmentProducts">
      <ion-segment-button value="allProducts">
        Todos los productos
      </ion-segment-button>
      <ion-segment-button value="myProducts">
        Mis productos
      </ion-segment-button>
    </ion-segment>
  </ion-toolbar>
</ion-header>
<ion-content [fullscreen]="true" id="products">
  <div *ngIf="dataLoaded">
    <ion-grid>
      <ion-row *ngIf="segmentProducts === 'allProducts'">
        <ion-col
          class="p-0 d-flex flex-row justify-content-start"
          *ngFor="let product of principalProducts"
        >
          <ion-card (click)="openModalShowProduct(product)">
            <div class="img w-100 text-center">
              <img
                [src]="product.image"
                class="mx-auto"
                alt="Imagen del producto"
              />
            </div>
            <ion-card-header>
              <ion-card-subtitle
                >{{product.price ? product.price + '€' :
                'Recomendado'}}</ion-card-subtitle
              >
              <ion-card-title>{{product.name}}</ion-card-title>
            </ion-card-header>
          </ion-card>
        </ion-col>
        <ion-infinite-scroll
          threshold="100px"
          (ionInfinite)="loadPrincipalProductData($event)"
        >
          <ion-infinite-scroll-content
            loadingSpinner="bubbles"
            loadingText="Cargado mas productos..."
          >
          </ion-infinite-scroll-content>
        </ion-infinite-scroll>
      </ion-row>
      <ion-row *ngIf="segmentProducts != 'allProducts'">
        <ion-col
          class="p-0 d-flex flex-row justify-content-start"
          *ngFor="let product of userProducts"
        >
          <ion-card (click)="openModalShowProduct(product)">
            <div class="img w-100 text-center">
              <img
                [src]="product.image"
                class="mx-auto"
                alt="Imagen del producto"
              />
            </div>
            <ion-card-header>
              <ion-card-subtitle
                >{{product.price ? product.price + '€' :
                'Recomendado'}}</ion-card-subtitle
              >
              <ion-card-title>{{product.name}}</ion-card-title>
            </ion-card-header>
          </ion-card>
        </ion-col>
        <ion-infinite-scroll
          threshold="100px"
          (ionInfinite)="loadUserProductData($event)"
        >
          <ion-infinite-scroll-content
            loadingSpinner="bubbles"
            loadingText="Cargado mas productos..."
          >
          </ion-infinite-scroll-content>
        </ion-infinite-scroll>
      </ion-row>
    </ion-grid>
  </div>
  <div *ngIf="!dataLoaded">
    <ion-grid>
      <ion-row>
        <ion-col class="p-0 d-flex flex-row justify-content-start">
          <ion-card>
            <div class="img w-100 text-center" style="height: 60%">
              <ion-skeleton-text
                animated
                class="m-0 h-100 w-100"
              ></ion-skeleton-text>
            </div>
            <ion-skeleton-text
              animated
              style="width: 50%"
              class="mt-3 mb-4 ms-3"
            ></ion-skeleton-text>
            <ion-card-header class="py-0">
              <ion-skeleton-text
                animated
                style="width: 90%"
                class="mb-2"
              ></ion-skeleton-text>
              <ion-skeleton-text
                animated
                style="width: 40%"
              ></ion-skeleton-text>
            </ion-card-header>
          </ion-card>
        </ion-col>
        <ion-col class="p-0 d-flex flex-row justify-content-start">
          <ion-card>
            <div class="img w-100 text-center" style="height: 60%">
              <ion-skeleton-text
                animated
                class="m-0 h-100 w-100"
              ></ion-skeleton-text>
            </div>
            <ion-skeleton-text
              animated
              style="width: 50%"
              class="mt-3 mb-4 ms-3"
            ></ion-skeleton-text>
            <ion-card-header class="py-0">
              <ion-skeleton-text
                animated
                style="width: 90%"
                class="mb-2"
              ></ion-skeleton-text>
              <ion-skeleton-text
                animated
                style="width: 40%"
              ></ion-skeleton-text>
            </ion-card-header>
          </ion-card>
        </ion-col>
        <ion-col class="p-0 d-flex flex-row justify-content-start">
          <ion-card>
            <div class="img w-100 text-center" style="height: 60%">
              <ion-skeleton-text
                animated
                class="m-0 h-100 w-100"
              ></ion-skeleton-text>
            </div>
            <ion-skeleton-text
              animated
              style="width: 50%"
              class="mt-3 mb-4 ms-3"
            ></ion-skeleton-text>
            <ion-card-header class="py-0">
              <ion-skeleton-text
                animated
                style="width: 90%"
                class="mb-2"
              ></ion-skeleton-text>
              <ion-skeleton-text
                animated
                style="width: 40%"
              ></ion-skeleton-text>
            </ion-card-header>
          </ion-card>
        </ion-col>
        <ion-col class="p-0 d-flex flex-row justify-content-start">
          <ion-card>
            <div class="img w-100 text-center" style="height: 60%">
              <ion-skeleton-text
                animated
                class="m-0 h-100 w-100"
              ></ion-skeleton-text>
            </div>
            <ion-skeleton-text
              animated
              style="width: 50%"
              class="mt-3 mb-4 ms-3"
            ></ion-skeleton-text>
            <ion-card-header class="py-0">
              <ion-skeleton-text
                animated
                style="width: 90%"
                class="mb-2"
              ></ion-skeleton-text>
              <ion-skeleton-text
                animated
                style="width: 40%"
              ></ion-skeleton-text>
            </ion-card-header>
          </ion-card>
        </ion-col>
      </ion-row>
    </ion-grid>
  </div>
  
  <ion-fab vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-button (click)="openModalCreateProduct()">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>

<ion-menu side="start" menuId="filtersSort" content-id="products">
  <ion-header>
    <ion-toolbar translucent>
      <ion-title>Ordenar por</ion-title>
      <ion-buttons slot="end" (click)="closeMenuSort()">
        <ion-button>Cerrar</ion-button>
      </ion-buttons>
    </ion-toolbar>
  </ion-header>
  <ion-content>
    <ion-list class="py-0">
      <ion-item
        (click)="changeSort('last_modified','asc') "
        [ngClass]="orderBy === 'last_modified' && orderDirection === 'asc' ? 'selected' : ''"
      >
        <ion-icon name="calendar-outline" slot="start"></ion-icon>
        <ion-label>Fecha asc.</ion-label>
      </ion-item>
      <ion-item 
      (click)="changeSort('last_modified', 'desc')"
      [ngClass]="orderBy === 'last_modified' && orderDirection === 'desc' ? 'selected' : ''"
      >
        <ion-icon name="today-outline" slot="start"></ion-icon>
        <ion-label>Fecha desc.</ion-label>
      </ion-item>
      <ion-item 
      (click)="changeSort('price','asc')"
      [ngClass]="orderBy === 'price' && orderDirection === 'asc' ? 'selected' : ''"
      >
        <ion-icon name="pricetag-outline" slot="start"></ion-icon>
        <ion-label>Precio asc.</ion-label>
      </ion-item>
      <ion-item 
      (click)="changeSort('price', 'desc')"
      [ngClass]="orderBy === 'price' && orderDirection === 'desc' ? 'selected' : ''"
      >
        <ion-icon name="cash-outline" slot="start"></ion-icon>
        <ion-label>Precio desc.</ion-label>
      </ion-item>
    </ion-list>
  </ion-content>
</ion-menu>
